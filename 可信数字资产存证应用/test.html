<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>无标题文档</title>
	<script>
	function calculate(){  
    	var fileReader = new FileReader(),  
        k=document.getElementById('k'); 
        blobSlice = File.prototype.mozSlice || File.prototype.webkitSlice || File.prototype.slice,  
        file = document.getElementById("file").files[0],  
        chunkSize = 2097152,  
        // read in chunks of 2MB  
        chunks = Math.ceil(file.size / chunkSize),  
        currentChunk = 0,  
        spark = new SparkMD5();  

		fileReader.onload = function(e) {  
			console.log("read chunk nr", currentChunk + 1, "of", chunks);  
			spark.appendBinary(e.target.result); // append binary string  
			currentChunk++;  

			if (currentChunk < chunks) {  
				loadNext();  
			}  
			else {  
				console.log("finished loading");  
				var flag = spark.end();
				k.innerText="文件的hash值为："+flag;
				k_search=flag;
				console.info("computed hash", spark.end()); // compute hash  
			}  
    };  

		function loadNext() {  
        	var start = currentChunk * chunkSize,  
				end = start + chunkSize >= file.size ? file.size : start + chunkSize;  

        	fileReader.readAsBinaryString(blobSlice.call(file, start, end));  
		};  

    	loadNext();  
	}  

	</script>
</head>

<body>
</body>
</html>
